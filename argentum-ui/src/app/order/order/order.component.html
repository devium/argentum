<div (window:resize)="onResize($event.target)" class="h-100 container-fluid d-sm-flex flex-sm-column p-0">
  <app-card-bar [fullscreen]="false" [message]="message"></app-card-bar>

  <div class="container-fluid row h-100 m-0 p-0 container-outer">

    <div class="message-wrap position-fixed">
      <app-message class="text-center d-block mx-auto"></app-message>
    </div>

    <div class="container-grid-range">

      <!-- Product range selection. -->
      <div class="row m-0">
        <div ngbDropdown class="w-100 p-1">
          <button
            (focus)="$event.target.blur()"
            class="btn btn-primary w-100"
            ngbDropdownToggle
          >
            {{selectedRange ? selectedRange.name : 'Select product range'}}
          </button>
          <div ngbDropdownMenu>
            <button
              *ngFor="let range of productRanges"
              (focus)="$event.target.blur()"
              (click)="setProductRange(range)"
              class="dropdown-item"
            >
              {{range.name}}
            </button>
          </div>
        </div>
      </div>

      <!-- Actual grid body. -->
      <div class="row-grid-body">

        <!-- Product buttons. -->
        <div
          *ngFor="let product of getPaginated(products, rangeProductsPerPage, rangePage)"
          class="col-product-range"
        >
          <button
            (focus)="$event.target.blur()"
            (click)="rangeProductClicked(product)"
            type="button"
            class="btn-product"
            [style.background-color]="product.categoryId ? categories.get(product.categoryId).color : '#ffffff'"
            [class.dark-bg]="product.categoryId && isDarkBackground(categories.get(product.categoryId).color)"
          >
            <div class="product-name">{{product.name}}</div>
            <div>
              <span class="product-price">€{{product.price | number: '1.2-2'}}</span>
            </div>
          </button>
        </div>

        <!-- Padding buttons. -->
        <div
          *ngFor="let i of 1 | range : getNumPadItems(products.length, rangeProductsPerPage, rangePage)"
          class="col-product-range"
        >
          <button type="button" class="btn-product btn-dummy" disabled>
            <div class="product-name">&zwnj;</div>
            <div>&zwnj;</div>
          </button>
        </div>

        <!-- Custom product button. -->
        <div class="col-product-range">
          <button
            (focus)="$event.target.blur()"
            (click)="addCustomProduct()"
            type="button"
            class="btn-product btn-outline-primary btn-product-custom"
          >
            <div class="product-name">Custom</div>
          </button>
        </div>

      </div>

      <!-- Pagination. -->
      <div class="row justify-content-center mx-0 my-1">
        <ngb-pagination
          [collectionSize]="products.length"
          [(page)]="rangePage"
          [pageSize]="rangeProductsPerPage"
          [maxSize]="pagesShown"
          [rotate]="true"
          [ellipses]="false"
        >
        </ngb-pagination>
      </div>

      <!-- Refresh and order history buttons. -->
      <div class="row m-0">
        <div class="col-6 p-1">
          <button
            (focus)="$event.target.blur()"
            (click)="refreshProducts()"
            type="button"
            class="btn-grid-row-multi"
            [disabled]="!selectedRange"
          >
            <i class="fa fa-refresh fa-lg"></i>
          </button>
        </div>
        <div class="col-6 p-1">
          <button
            (focus)="$event.target.blur()"
            (click)="showOrderHistory()"
            type="button"
            class="btn-grid-row-multi"
            [disabled]="this.cardBar.state != this.cardBar.scanState.Valid"
          >
            <i class="fa fa-history fa-lg"></i>
          </button>
        </div>
      </div>

    </div>


    <div class="container-grid-order">

      <!-- "Current order" title "button". -->
      <div class="row m-0">
        <button
          (focus)="$event.target.blur()"
          disabled
          class="btn-grid-row-single"
        >
          Current order: €{{total | number:'1.2-2'}}
        </button>
      </div>

      <!-- Actual grid body. -->
      <div class="row-grid-body">

        <!-- Product buttons. -->
        <div
          *ngFor="let productEntry of orderedProducts | iterable | slice:(orderProductsPerPage * (orderPage - 1)):(orderProductsPerPage * orderPage)"
          class="col-product-order"
        >

          <button
            (focus)="$event.target.blur()"
            (mouseup)="orderedProductClicked(productEntry.key)"
            type="button"
            class="btn btn-block btn-product"
            [style.background-color]="productEntry.key.categoryId ? categories.get(productEntry.key.categoryId).color : '#ffffff'"
            [class.dark-bg]="productEntry.key.categoryId && isDarkBackground(categories.get(productEntry.key.categoryId).color)"
            [class.btn-outline-primary]="productEntry.key.id == -1"
          >
            <div class="product-name">{{productEntry.key.name}}</div>
            <div>
              <span class="product-price">€{{productEntry.key.price | number: '1.2-2'}}</span>
              <span *ngIf="productEntry.key.id > -1" class="product-quantity">x{{productEntry.value}}</span>
            </div>
          </button>
        </div>

        <!-- Padding buttons. -->
        <div
          *ngFor="let i of 1 | range : getNumPadItems(orderedProducts.size, orderProductsPerPage, orderPage)"
          class="col-product-order"
        >
          <button type="button" class="btn-product btn-dummy" disabled>
            <div class="product-name">&zwnj;</div>
            <div>&zwnj;</div>
          </button>
        </div>

      </div>

      <!-- Pagination. -->
      <div class="row justify-content-center mx-0 my-1">
        <ngb-pagination
          [collectionSize]="orderedProducts.size"
          [(page)]="orderPage"
          [pageSize]="orderProductsPerPage"
          [maxSize]="pagesShown"
          [rotate]="true"
          [ellipses]="false"
        >

        </ngb-pagination>
      </div>

      <!-- Clear and buy buttons. -->
      <div class="row m-0">
        <div class="col-6 p-1">
          <button
            (focus)="$event.target.blur()"
            (click)="clear()"
            type="button"
            class="btn-grid-row-multi"
            [disabled]="this.waitingForOrder || this.orderedProducts.size == 0"
          >
            <i class="fa fa-trash fa-lg"></i>
          </button>
        </div>

        <div class="col-6 p-1">
          <button
            (focus)="$event.target.blur()"
            (click)="placeOrder()"
            type="button"
            class="btn-grid-row-multi"
            [disabled]="this.waitingForOrder || this.orderedProducts.size == 0 || this.cardBar.state != this.cardBar.scanState.Valid"
          >
            <i class="fa fa-shopping-cart fa-lg mr-1"></i>
            <i class="fa fa-long-arrow-right fa-lg"></i>
          </button>
        </div>

      </div>

    </div>

  </div>

  <app-navbar></app-navbar>
</div>
