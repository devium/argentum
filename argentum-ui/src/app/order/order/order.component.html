<div (window:resize)="onResize($event.target)" class="h-100 container-fluid d-sm-flex flex-sm-column p-0">
  <div class="container-fluid row h-100 m-0 p-0 container-outer">

    <div class="message-wrap position-fixed">
      <app-message class="text-center d-block mx-auto"></app-message>
    </div>

    <div class="container-grid-range">

      <!-- Product range selection. -->
      <div class="row m-0">
        <div ngbDropdown class="w-100 p-1">
          <button
            class="btn btn-primary w-100"
            ngbDropdownToggle
          >
            {{selectedRange ? selectedRange.name : 'Select product range'}}
          </button>
          <div ngbDropdownMenu>
            <button
              *ngFor="let productRange of productRanges"
              (click)="setProductRange(productRange)"
              class="dropdown-item"
            >
              {{productRange.name}}
            </button>
          </div>
        </div>
      </div>

      <!-- Actual grid body. -->
      <div class="row-grid-body">

        <ng-container *ngIf="selectedRange && selectedRange.products">
          <!-- Product buttons. -->
          <div
            *ngFor="let product of getPaginated(selectedRange.products, rangeProductsPerPage, rangePage)"
            class="col-product-range"
          >
            <button
              (click)="rangeProductClicked(product)"
              type="button"
              class="btn-product"
              [style.background-color]="product.category ? product.category.color : '#ffffff'"
              [class.dark-bg]="product.category && isDarkBackground(product.category.color)"
            >
              <div class="product-name">{{product.name}}</div>
              <div>
                <span class="product-price">€{{formatCurrency(product.price)}}</span>
              </div>
            </button>
          </div>
        </ng-container>

        <!-- Padding buttons. -->
        <div
          *ngFor="let i of 1 | range : getNumPadItems(selectedRange && selectedRange.products ? selectedRange.products.length : 0, rangeProductsPerPage, rangePage)"
          class="col-product-range"
        >
          <button type="button" class="btn-product btn-dummy" disabled>
            <div class="product-name">&zwnj;</div>
            <div>&zwnj;</div>
          </button>
        </div>

        <!-- Custom product button. -->
        <div class="col-product-range">
          <button
            (click)="addCustomProduct()"
            type="button"
            class="btn-product btn-outline-primary btn-product-custom"
          >
            <div class="product-name">Custom</div>
          </button>
        </div>

      </div>

      <!-- Pagination. -->
      <div class="row justify-content-center mx-0 my-1">
        <ngb-pagination
          [collectionSize]="selectedRange && selectedRange.products ? selectedRange.products.length : 0"
          [(page)]="rangePage"
          [pageSize]="rangeProductsPerPage"
          [maxSize]="pagesShown"
          [rotate]="true"
          [ellipses]="false"
        >
        </ngb-pagination>
      </div>

      <!-- Refresh and order history buttons. -->
      <div class="row m-0">
        <div class="col-6 p-1">
          <button
            (click)="refreshProducts()"
            type="button"
            class="btn-grid-row-multi"
            [disabled]="!selectedRange"
          >
            <i class="fa fa-refresh fa-lg"></i>
          </button>
        </div>
        <div class="col-6 p-1">
          <button
            (click)="showOrderHistory()"
            type="button"
            class="btn-grid-row-multi"
          >
            <i class="fa fa-history fa-lg"></i>
          </button>
        </div>
      </div>

    </div>


    <div class="container-grid-order">

      <!-- "Current order" title "button". -->
      <div class="row m-0">
        <button
          disabled
          class="btn-grid-row-single"
        >
          Current order: <b>€{{formatCurrency(total)}}</b>
        </button>
      </div>

      <!-- Actual grid body. -->
      <div class="row-grid-body">

        <!-- Product buttons. -->
        <div
          *ngFor="let orderItem of getPaginated(orderItems, orderProductsPerPage, orderPage)"
          class="col-product-order"
        >

          <button
            (mouseup)="orderItemClicked(orderItem)"
            type="button"
            class="btn btn-block btn-product"
            [style.background-color]="orderItem.product.category ? orderItem.product.category.color : '#ffffff'"
            [class.dark-bg]="orderItem.product.category && isDarkBackground(orderItem.product.category.color)"
            [class.btn-outline-primary]="!orderItem.product.id"
          >
            <div class="product-name">{{orderItem.product.name}}</div>
            <div>
              <span class="product-price">€{{orderItem.product.price | number: '1.2-2'}}</span>
              <span *ngIf="orderItem.product.id" class="product-quantity">x{{orderItem.quantityInitial}}</span>
            </div>
          </button>
        </div>

        <!-- Padding buttons. -->
        <div
          *ngFor="let i of 1 | range : getNumPadItems(orderItems.length, orderProductsPerPage, orderPage)"
          class="col-product-order"
        >
          <button type="button" class="btn-product btn-dummy" disabled>
            <div class="product-name">&zwnj;</div>
            <div>&zwnj;</div>
          </button>
        </div>

      </div>

      <!-- Pagination. -->
      <div class="row justify-content-center mx-0 my-1">
        <ngb-pagination
          [collectionSize]="orderItems.length"
          [(page)]="orderPage"
          [pageSize]="orderProductsPerPage"
          [maxSize]="pagesShown"
          [rotate]="true"
          [ellipses]="false"
        >

        </ngb-pagination>
      </div>

      <!-- Clear and buy buttons. -->
      <div class="row m-0">
        <div class="col-6 p-1">
          <button
            (click)="clear()"
            type="button"
            class="btn-grid-row-multi"
            [disabled]="this.orderItems.length === 0"
          >
            <i class="fa fa-trash fa-lg"></i>
          </button>
        </div>

        <div class="col-6 p-1">
          <button
            (click)="placeOrder()"
            type="button"
            class="btn-grid-row-multi"
            [disabled]="this.orderItems.length == 0"
          >
            <i class="fa fa-shopping-cart fa-lg mr-1"></i>
            <i class="fa fa-long-arrow-right fa-lg"></i>
          </button>
        </div>

      </div>

    </div>

  </div>

  <app-navbar></app-navbar>
</div>
